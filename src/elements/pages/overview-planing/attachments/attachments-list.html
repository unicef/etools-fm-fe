<!--import [polymer/polymer-element, paper-card, etools-dropdown, iron-flex-layout, etools-dialog, paper-input,
            etools-data-table, etools-file, moment-element]-->

<!--import [shared-styles, module-styles, tab-inputs-styles, table-styles, common-methods, redux-mixin,
            route-helper-mixin, process-data-mixin]-->

<dom-module id="attachments-list">
    <template>
        <style include="shared-styles module-styles tab-inputs-styles iron-flex table-styles iron-flex-factors"></style>
        <!-- inject styles './attachments-list.scss'-->


        <div class="table-title-block with-bottom-line">
            <div class="table-title">[[permissions.title]]</div>
            <div class="buttons-container">
                <paper-icon-button
                        on-tap="_openUploadAttachment"
                        class="panel-button"
                        data-type="add"
                        icon="add-box"></paper-icon-button>
            </div>
        </div>
        <etools-data-table-header id="listHeader" no-collapse no-title>
            <etools-data-table-column class="flex-1" field="created">
                [[getDescriptorLabel(permissions, 'created')]]
            </etools-data-table-column>
            <etools-data-table-column class="flex-1" field="file_type">
                [[getDescriptorLabel(permissions, 'file_type')]]
            </etools-data-table-column>
            <etools-data-table-column class="flex-4" field="file">
                [[getDescriptorLabel(permissions, 'file')]]
            </etools-data-table-column>
        </etools-data-table-header>
        <template is="dom-if" if="[[!attachments.length]]">
            <etools-data-table-row no-collapse>
                <div slot="row-data" class="layout horizontal">
                    <div  class="col-data flex-1 truncate">-</div>
                </div>
                <div slot="row-data" class="layout horizontal">
                    <div  class="col-data flex-1 truncate">-</div>
                </div>
                <div slot="row-data" class="layout horizontal">
                    <div  class="col-data flex-4 truncate">-</div>
                </div>
            </etools-data-table-row>
        </template>
        <template is="dom-repeat" items="[[attachments]]" as="item">
            <etools-data-table-row no-collapse secondary-bg-on-hover>
                <div slot="row-data" class="layout horizontal editable-row">
                    <div class="col-data flex-1 truncate">
                        [[formatDate(item.created)]]
                    </div>
                    <div class="col-data flex-1 truncate">
                        [[getChoiceLabel(item.file_type, fileTypes)]]
                    </div>
                    <div class="col-data flex-4 truncate file-link">
                        <iron-icon icon="icons:attachment"></iron-icon>
                        <a class="file-link" href$="[[item.file]]">[[item.filename]]</a>
                    </div>
                    <template is="dom-if" if="[[isAllowEdit(permissions)]]">
                        <div class="hover-block">
                            <iron-icon icon="icons:create" on-click="openDialog"></iron-icon>
                            <iron-icon icon="icons:clear" on-click="onDeleteAttachment"></iron-icon>
                        </div>
                    </template>
                </div>
            </etools-data-table-row>
        </template>

        <etools-dialog
                size="md"
                no-padding
                keep-dialog-open
                opened="{{dialog.opened}}"
                ok-btn-text="[[dialog.confirm]]"
                dialog-title="[[dialog.title]]"
                on-confirm-btn-clicked="onFinishUpload">
            <etools-loading
                    active="[[requestInProcess]]"
                    loading-text="Saving Attachment"></etools-loading>
            <div class="container layout horizontal">
                <etools-dropdown
                    class="validate-input disabled-as-readonly flex-1"
                    selected="{{selectedModel.file_type}}"
                    label="[[getDescriptorLabel(permissions, 'file_type')]]"
                    placeholder="[[getPlaceholder(permissions, 'file_type', 'Select')]]"
                    options="[[fileTypes]]"
                    option-label="display_name"
                    option-value="value"
                    required$="[[getRequiredStatus(permissions, 'file_type')]]"
                    invalid="{{errors.file_type}}"
                    error-message="{{errors.file_type}}"
                    on-focus="resetFieldError"
                    on-tap="resetFieldError"
                    allow-outside-scroll
                    dynamic-align>
                </etools-dropdown>
                <div>
                    <etools-file files="{{file}}" hide-delete-btn></etools-file>
                </div>
            </div>
        </etools-dialog>

        <etools-dialog
                size="md"
                no-padding
                keep-dialog-open
                theme="confirmation"
                opened="{{dialogDelete.opened}}"
                ok-btn-text="Delete"
                on-confirm-btn-clicked="onFinishDelete">
            <etools-loading
                    active="[[requestInProcess]]"
                    loading-text="Deleting Attachment"></etools-loading>
            <div class="container layout horizontal">
                <div>Delete attachment?</div>
            </div>
        </etools-dialog>
    </template>
    <!-- inject scripts './attachments-list.ts'-->
</dom-module>
