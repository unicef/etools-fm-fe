<!--import [polymer/polymer-element, etools-dropdown, iron-flex-layout, iron-icons, iron-collapse, etools-loading]-->

<!--import [pages-header, redux-mixin, etools-app-config]-->

<dom-module id="co-overview">
    <template>
        <!-- inject styles './co-overview.scss'-->
        <style include="iron-flex iron-flex-factors iron-flex-alignment tab-inputs-styles"></style>

        <app-route route="{{route}}" pattern="/co-overview" active="{{isActive}}"></app-route>

        <paper-card>
            <div class="layout horizontal">
                <div class="filter-dropdown">
                    <etools-dropdown
                            selected="[[queryParams.cp_outcome]]"
                            label="CP Outcome"
                            placeholder="Select"
                            options="[[cpOutcomes]]"
                            option-label="name"
                            option-value="id"
                            trigger-value-change-event
                            on-etools-selected-item-changed="filterValueChanged"
                            hide-search allow-outside-scroll>
                    </etools-dropdown>
                </div>
            </div>
        </paper-card>

        <template is="dom-repeat" items="[[filteredConfigs]]">
            <paper-card class="cp-output-container">
                <div class="cp-output-title layout horizontal">
                    <iron-icon icon="expand-less" hidden$="[[isDetailsOpened(item.cp_output.id, openedConfig)]]" on-tap="toggleDetails" data-config-id$="[[item.cp_output.id]]"></iron-icon>
                    <iron-icon icon="expand-more" hidden$="[[!isDetailsOpened(item.cp_output.id, openedConfig)]]" on-tap="toggleDetails" data-config-id$="[[item.cp_output.id]]"></iron-icon>
                    [[item.name]]
                    <iron-icon icon="flag" class="flag-icon"></iron-icon>
                </div>

                <iron-collapse opened="[[isDetailsOpened(item.cp_output.id, openedConfig)]]">
                    <div class="spinner" hidden$="[[detailsAreLoaded(item.cp_output.id, fullReportLoading)]]"><etools-loading active></etools-loading></div>
                    <template is="dom-if" if="[[detailsAreLoaded(item.cp_output.id, fullReportLoading)]]">
                        <div class="details-container">

                            <div class="cp-indicators">
                                <div class="line layout horizontal title">
                                    <div class="indicators flex-auto">CP Indicators</div>
                                    <div class="target flex-none">Target</div>
                                </div>

                                <template is="dom-repeat" items="[[getCpIndicators(item.cp_output.id)]]">
                                    <div class$="line layout horizontal [[getBackground(index)]]">
                                        <div class="indicators flex-auto">[[item]]</div>
                                        <div class="target flex-none">--</div>
                                    </div>
                                </template>

                                <div class="line layout horizontal" hidden$="[[!indicatorsEmpty(item.cp_output.id)]]">
                                    <div class="indicators flex-auto">--</div>
                                    <div class="target flex-none">--</div>
                                </div>
                            </div>

                        </div>
                    </template>
                </iron-collapse>
            </paper-card>
        </template>

    </template>

    <!-- inject scripts './co-overview.ts'-->
</dom-module>
