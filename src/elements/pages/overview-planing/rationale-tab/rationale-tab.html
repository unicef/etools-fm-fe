<!--import [polymer/polymer-element, paper-card, etools-dropdown, iron-flex-layout, etools-dialog, paper-input,
            etools-data-table, attachments-list, textarea-max-rows-mixin]-->

<!--import [shared-styles, module-styles, tab-inputs-styles, table-styles, common-methods, redux-mixin,
            route-helper-mixin, process-data-mixin, textarea-max-rows-mixin]-->

<dom-module id="rationale-tab">
    <template>
        <style include="shared-styles module-styles tab-inputs-styles iron-flex table-styles iron-flex-factors"></style>
        <!-- inject styles './rationale-tab.scss'-->

        <app-route route="{{route}}" pattern="/rationale" active="{{isActive}}"></app-route>


        <paper-card class="table-container">

            <div class="table-title-block with-bottom-line">
                <div class="table-title">[[permissions.title]]</div>
                <div class="buttons-container">
                    <div class="history-info" hidden$="[[!yearPlan.history.length]]">
                        Last editeb by [[yearPlan.history.0.by_user_display]] on [[getChangesDate(yearPlan.history.0.created)]]
                    </div>
                    <paper-icon-button
                            hidden$="[[isReadonlyCollection(permissions)]]"
                            on-tap="openEditDialog"
                            class="panel-button"
                            data-type="edit"
                            icon="create"></paper-icon-button>
                </div>
            </div>

            <div class="container layout vertical rational-view">
                <div class="text-control">
                    <label>[[getDescriptorLabel(permissions, 'prioritization_criteria', yearPlan)]]</label>
                    <div class="value">[[formatValue(yearPlan.prioritization_criteria)]]</div>
                </div>
                <div class="text-control">
                    <label>[[getDescriptorLabel(permissions, 'methodology_notes', yearPlan)]]</label>
                    <div class="value">[[formatValue(yearPlan.methodology_notes)]]</div>
                </div>
                <div class="text-control">
                    <label>[[getDescriptorLabel(permissions, 'modalities', yearPlan)]]</label>
                    <div class="value">[[formatValue(yearPlan.modalities)]]</div>
                </div>
                <div class="text-control">
                    <label>[[getDescriptorLabel(permissions, 'target_visits', yearPlan)]]</label>
                    <div class="value">[[formatValue(yearPlan.target_visits)]]</div>
                </div>
                <div class="text-control">
                    <label>[[getDescriptorLabel(permissions, 'partner_engagement', yearPlan)]]</label>
                    <div class="value">[[formatValue(yearPlan.partner_engagement)]]</div>
                </div>
                <div class="text-control">
                    <label>[[getDescriptorLabel(permissions, 'other_aspects', yearPlan)]]</label>
                    <div class="value">[[formatValue(yearPlan.other_aspects)]]</div>
                </div>
            </div>

        </paper-card>


        <paper-card class="table-container">
            <attachments-list></attachments-list>
        </paper-card>


        <etools-dialog
                size="md"
                no-padding
                keep-dialog-open
                opened="{{dialog.opened}}"
                ok-btn-text="Save"
                dialog-title="Rationale"
                on-confirm-btn-clicked="onFinishEdit">
            <etools-loading
                    active="[[requestInProcess]]"
                    loading-text="Saving Data">
            </etools-loading>

            <div class="layout vertical">
                <div class="container">
                    <paper-textarea
                            class="validate-input disabled-as-readonly flex"
                            value="{{selectedModel.prioritization_criteria}}"
                            max-rows="3"
                            label="[[getDescriptorLabel(permissions, 'prioritization_criteria')]]"
                            placeholder="[[getPlaceholder(permissions, 'prioritization_criteria', 'Enter')]]"
                            required$="[[getRequiredStatus(permissions, 'prioritization_criteria')]]"
                            disabled$="[[getReadonlyStatus(permissions, 'prioritization_criteria')]]"
                            readonly$="[[getReadonlyStatus(permissions, 'prioritization_criteria')]]"
                            invalid="{{errors.prioritization_criteria}}"
                            error-message="{{errors.prioritization_criteria}}"
                            on-focus="resetFieldError"
                            on-tap="resetFieldError">
                    </paper-textarea>
                    <div class="helper-text">e.g Geographic areas where results are most challenged, outputs associated with a humanitarian response</div>
                </div>
                <div class="container">
                    <paper-textarea
                            class="validate-input disabled-as-readonly flex"
                            value="{{selectedModel.methodology_notes}}"
                            max-rows="3"
                            label="[[getDescriptorLabel(permissions, 'methodology_notes')]]"
                            placeholder="[[getPlaceholder(permissions, 'methodology_notes', 'Enter')]]"
                            required$="[[getRequiredStatus(permissions, 'methodology_notes')]]"
                            disabled$="[[getReadonlyStatus(permissions, 'methodology_notes')]]"
                            readonly$="[[getReadonlyStatus(permissions, 'methodology_notes')]]"
                            invalid="{{errors.methodology_notes}}"
                            error-message="{{errors.methodology_notes}}"
                            on-focus="resetFieldError"
                            on-tap="resetFieldError">
                    </paper-textarea>
                    <div class="helper-text">e.g Variations on standard methodology and rationale, specifications on minimum number and type of FGDs</div>
                </div>
                <div class="container">
                    <paper-textarea
                            class="validate-input disabled-as-readonly flex"
                            value="{{selectedModel.modalities}}"
                            max-rows="3"
                            label="[[getDescriptorLabel(permissions, 'modalities')]]"
                            placeholder="[[getPlaceholder(permissions, 'modalities', 'Enter')]]"
                            required$="[[getRequiredStatus(permissions, 'modalities')]]"
                            disabled$="[[getReadonlyStatus(permissions, 'modalities')]]"
                            readonly$="[[getReadonlyStatus(permissions, 'modalities')]]"
                            invalid="{{errors.modalities}}"
                            error-message="{{errors.modalities}}"
                            on-focus="resetFieldError"
                            on-tap="resetFieldError">
                    </paper-textarea>
                    <div class="helper-text">e.g Staff, UNV, SSAs, TPMs to undertake field monitoring</div>
                </div>
                <div class="container">
                    <paper-input
                            class="validate-input disabled-as-readonly flex numeric-input"
                            value="{{selectedModel.target_visits}}"
                            type="number"
                            label="[[getDescriptorLabel(permissions, 'target_visits')]]"
                            placeholder="[[getPlaceholder(permissions, 'target_visits', 'Enter')]]"
                            required$="[[getRequiredStatus(permissions, 'target_visits')]]"
                            disabled$="[[getReadonlyStatus(permissions, 'target_visits')]]"
                            readonly$="[[getReadonlyStatus(permissions, 'target_visits')]]"
                            on-input="onTargetVisitsChange"
                            on-focus="resetFieldError"
                            on-tap="resetFieldError">
                    </paper-input>
                </div>
                <div class="container">
                    <paper-textarea
                            class="validate-input disabled-as-readonly flex"
                            value="{{selectedModel.partner_engagement}}"
                            max-rows="3"
                            label="[[getDescriptorLabel(permissions, 'partner_engagement')]]"
                            placeholder="[[getPlaceholder(permissions, 'partner_engagement', 'Enter')]]"
                            required$="[[getRequiredStatus(permissions, 'partner_engagement')]]"
                            disabled$="[[getReadonlyStatus(permissions, 'partner_engagement')]]"
                            readonly$="[[getReadonlyStatus(permissions, 'partner_engagement')]]"
                            on-focus="resetFieldError"
                            on-tap="resetFieldError">
                    </paper-textarea>
                    <div class="helper-text">e.g any arrangements established for join visits</div>
                </div>
                <div class="container">
                    <paper-textarea
                            class="validate-input disabled-as-readonly flex"
                            value="{{selectedModel.other_aspects}}"
                            max-rows="3"
                            label="[[getDescriptorLabel(permissions, 'other_aspects')]]"
                            placeholder="e.g any arrangements established for join visits"
                            required$="[[getRequiredStatus(permissions, 'other_aspects')]]"
                            disabled$="[[getReadonlyStatus(permissions, 'other_aspects')]]"
                            readonly$="[[getReadonlyStatus(permissions, 'other_aspects')]]"
                            invalid="{{errors.other_aspects}}"
                            error-message="{{errors.other_aspects}}"
                            on-focus="resetFieldError"
                            on-tap="resetFieldError">
                    </paper-textarea>
                </div>

            </div>

        </etools-dialog>
    </template>
    <!-- inject scripts './rationale-tab.ts'-->
</dom-module>
